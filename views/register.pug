doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Register - My Grocery Buddy
    link(rel="stylesheet", href="/css/style.css")
  
  body
    .auth-container
      .auth-card
        .auth-header
          h1 ðŸ›’ My Grocery Buddy
          p Create your account to start managing your grocery list
        
        //- Display backend messages
        if message
          .message(class=message.includes('âœ…') || message.toLowerCase().includes('success') ? 'success' : 'error')
            = message
        
        //- Success alert (hidden by default)
        #successAlert.message.success(style="display: none;")
          | âœ… Registration successful! Redirecting...
        
        form#registerForm.auth-form(action="/register" method="POST")
          .form-group
            label(for="username") Username
            input#username.form-input(
              type="text" 
              name="username" 
              placeholder="Choose a username"
              required
            )
            .error-text#usernameError
          
          .form-group
            label(for="email") Email
            input#email.form-input(
              type="email" 
              name="email" 
              placeholder="your@email.com"
              required
            )
            .error-text#emailError
          
          .form-group
            label(for="password") Password
            input#password.form-input(
              type="password" 
              name="password" 
              placeholder="At least 6 characters"
              required
            )
            .error-text#passwordError
          
          .form-group
            label(for="confirmPassword") Confirm Password
            input#confirmPassword.form-input(
              type="password" 
              name="confirmPassword" 
              placeholder="Re-enter password"
              required
            )
            .error-text#confirmPasswordError
          
          button.btn.btn-primary(type="submit") 
            span Register
        
        .auth-footer
          p Already have an account? 
            a(href="/login") Login here

    script.
      const form = document.getElementById('registerForm');
      const usernameInput = document.getElementById('username');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const confirmPasswordInput = document.getElementById('confirmPassword');
      const successAlert = document.getElementById('successAlert');

      const usernameError = document.getElementById('usernameError');
      const emailError = document.getElementById('emailError');
      const passwordError = document.getElementById('passwordError');
      const confirmPasswordError = document.getElementById('confirmPasswordError');

      form.addEventListener('submit', function(e) {
        let isValid = true;
        
        // Clear all errors
        [usernameError, emailError, passwordError, confirmPasswordError].forEach(error => {
          error.textContent = '';
        });
        [usernameInput, emailInput, passwordInput, confirmPasswordInput].forEach(input => {
          input.classList.remove('error');
        });
        
        // Validate username (at least 3 characters)
        if (usernameInput.value.trim().length < 3) {
          usernameError.textContent = 'Username must be at least 3 characters';
          usernameInput.classList.add('error');
          isValid = false;
        }
        
        // Validate email
        const emailValue = emailInput.value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailValue)) {
          emailError.textContent = 'Please enter a valid email address';
          emailInput.classList.add('error');
          isValid = false;
        }
        
        // Validate password (at least 6 characters)
        if (passwordInput.value.length < 6) {
          passwordError.textContent = 'Password must be at least 6 characters';
          passwordInput.classList.add('error');
          isValid = false;
        }
        
        // Validate confirm password
        if (confirmPasswordInput.value !== passwordInput.value) {
          confirmPasswordError.textContent = 'Passwords do not match';
          confirmPasswordInput.classList.add('error');
          isValid = false;
        }
        
        // If validation fails, prevent submission
        if (!isValid) {
          e.preventDefault();
          return;
        }
        
        // Show success alert
        e.preventDefault();
        successAlert.style.display = 'block';
        setTimeout(function() {
          form.submit();
        }, 800);
      });
      
      // Real-time validation on input
      usernameInput.addEventListener('input', function() {
        if (usernameInput.value.trim().length >= 3) {
          usernameError.textContent = '';
          usernameInput.classList.remove('error');
        }
      });
      
      emailInput.addEventListener('input', function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailRegex.test(emailInput.value.trim())) {
          emailError.textContent = '';
          emailInput.classList.remove('error');
        }
      });
      
      passwordInput.addEventListener('input', function() {
        if (passwordInput.value.length >= 6) {
          passwordError.textContent = '';
          passwordInput.classList.remove('error');
        }
        
        // Also check confirm password if it has value
        if (confirmPasswordInput.value !== '' && confirmPasswordInput.value === passwordInput.value) {
          confirmPasswordError.textContent = '';
          confirmPasswordInput.classList.remove('error');
        }
      });
      
      confirmPasswordInput.addEventListener('input', function() {
        if (confirmPasswordInput.value === passwordInput.value) {
          confirmPasswordError.textContent = '';
          confirmPasswordInput.classList.remove('error');
        }
      });